---
layout: post
title: 性能测试基础
categories: [性能测试]
description: 性能测试基础
keywords: 性能测试
topmost: true
---

# 什么是性能测试

性能测试是一项综合性的工作，致力于暴露性能问题，评估系统性能趋势。性能测试工作实质上是通过工具模拟大量用户操作来验证系统能够承受的负载的情况，找出潜在的性能问题，分析并解决。

# 性能测试流程

![test.png](https://i.loli.net/2020/09/23/juIgFoLfHemOci9.png)

1. 业务熟悉
2. 需求分析
3. 工作评估
4. 设计模型
5. 计划编写
6. 脚本开发
7. 测试环境准备
8. 测试数据准备
9. 测试执行
10. 缺陷管理
11. 性能分析
12. 性能调优
13. 测试报告
14. 评审

# 性能测试几大难点

### 需求分析

1. 不能仅根据项目经理或者有缺陷的文档来进行需求分析，大多数需要我们来引导运维人员和需求人员给出需求数据，并对数据进行二次分析，得出我们实际的性能需求。或者有明确的需求文档也可以作为参考
2. 对于初次上线的，需利用同行的系统数据进行数据估算法进行估算，得到负荷和响应时间数据可以用作验证我们所计划的模型的能力
3. 已上线的系统，通过运维人员获取TPS和时间的比例分布图、用户数、数据库关系图、容量数据，得出当前系统的用户行为和业务数据关系，得出我们需要的性能需求

### 场景设计、用例设计

1. 在充分的需求调研和分析后，需要尽可能真实的还原系统负载。通过需要我们决定那些功能参与性能执行，如何参与？这就是用例设计
2. 有效的组织用例就是场景，按业务，业务量，业务角色分配用户数。执行时间、执行比例

### 测试执行

> 模拟不同的负载执行测试场景识别系统弱点，做好各种监控，发现问题。下面会列出一些性能参考指标

### 性能诊断优化

> 把遇到的问题进行分类，协助开发团队进行问题定位，分析调优

# 性能测试指标

1. 并发用户：
   1. 绝对并发：虚拟用户在同一时刻做同一操作
   2. 相对并发：多个用户对系统做出了请求，可以相同也可以不同，是相对于系统而言的
   3. 并发误解：不是系统的总用户数
2. 错误率：
   1. 失败交易的概率，超时引起的叫超时率
   2. 一般不超过千分之六，成功率不低于99.4%
3. 点击率：
   1. 单位时间内向web提交的请求数
   2. 并不是指鼠标的点击数，有时鼠标点击一次会发出多个请求
4. 吞吐量：
   1. 指单位时间内能够给处理的事务/请求个数，反应系统的处理能力、

5. 思考时间：

   > 请求间的停顿，模拟用户的实际操作

6. 事务：

   > 在web性能测试中，一个事务表示发送请求到服务器再到前端页面返回的处理数据，事务可能由一个请求组成，也可能由多个请求组成

7. 事务响应时间：

   > 从发请求开始到收到服务器的响应结果这个时间段所耗费的时间，响应时间=网络响应时间+应用程序响应时间

8. 90%的事务响应时间

   1. 在一次的完整测试中，所有事务的响应时间，从小到大排列，90%的事务所消耗的时间范围
   2. 在评估一次的测试结果时，平均响应时间不能表示系统绝大多数用户的需求
   3. 标准参考业界的3/5/10  2/6/8

9. 资源利用率：

   1. 内存、CPU、网络、I/O，通常由最大值的百分比来衡量

# 性能测试分类

1. 负载测试：

   > •在一定的软件、硬件、网络条件下，通过运行一种或多种业务在**不同虚拟用户数量**情况下**，测试系统的性能指标是否在用户的要求范围内**，用于确定系统所能承受的最大有效用户数以及不同用户数下的系统响应时间及服务器的资源利用率。
   >
   > •负载测试强调的是在一定环境下系统能够达到的峰值指标，大多数的性能测试都是负载测试，这种方法的目的是找到系统处理能力的基线，通过模拟不同数量级的用户，找到如“响应时间不超过10秒”“服务器平均CPU利用率低于65%时的用户数”。

2. 压力测试：

   > •在一定的软件、硬件、网络条件下，通过模拟大量的虚拟用户向服务器产生负载，使服务器的资源处于极限状态下并长时间连续运行，以测试服务器在高负载情况下是否能够稳定工作。
   >
   > •与负载测试获得峰值性能数据不同，压力测试强调在极端情况下系统的稳定性，测试目标系统在一定饱和状态下，例如CPU、内存等在饱和状态下，系统还能稳定地提供服务。比如，在100个用户使用系统的时候，CPU使用率达到了性能测试指标的最大值，比如80%，那么101个用户就是压力值。

3. 稳定性测试：

   > 亦可称可靠性测试。通过给系统加载一定的业务压力，让系统持续运行一段时间（一般为7x24小时），检测系统是否能够稳定运行。

4. 疲劳测试：

   > 通常是采用被测应用稳定运行情况下能够支持的最大并发用户数，持续执行一段时间（至少24小时）业务，通过综合分析交易执行指标和资源监控指标来确定系统处理最大工作量强度性能的过程。

5. 容量测试：

   > 容量测试目的是通过测试预先分析出反映软件系统应用特征的某项指标的极限值(譬如系统最大用户数，最大存储量，最多处理的数据流量、数据库记录数等),系统在其极限值状态下没有出现任何软件故障或还能保持主要功能正常运行。

6. 配置测试：

   > 在不同的软件、硬件和网络条件下，通过运行一种或多种业务在一定的虚拟用户数量情况下，获得不同配置的性能指标，用于选择最佳的设备及参数配置。

7. 并发测试：

   > •通过模拟多个用户并发访问一个应用或一个应用的某个功能，同一个存储过程，或接口以及其他并发操作，测试程序是否支持多用户访问，是否存在死锁、线程同步问题。
   >
   > •通过接口并发测试可发现的问题：
   >
   > 现象：程序在单用户场景下运行成功，多用户运行则失败，提示连不上服务器
   >
   > 原因：程序没有做多线程处理
   >
   > 现象：程序实现的功能是：随机给用户分配不同的任务，单用户运行时，能成功分配，多用户并发申请任务时，所有用户得到的任务都是一样的
   >
   > 原因：程序存在线程同步的问题